<script>
// ====== ROBOT VISUALIZATION CORE ======
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const debug = document.getElementById('debug');

// Canvas setup
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

// Color mapping (from your enums.py)
const FAULT_COLORS = {
  CRASH: '#FF0000',
  BYZANTINE: '#FFA500',
  DELAY: '#FFFF00',
  NORMAL: '#00AAFF'
};

// Main draw function
function drawRobots(robots) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  robots.forEach(robot => {
    ctx.fillStyle = FAULT_COLORS[robot.fault] || FAULT_COLORS.NORMAL;
    ctx.beginPath();
    ctx.arc(robot.x, robot.y, 10, 0, Math.PI * 2);
    ctx.fill();
  });
}

// ====== CONNECTION TO PYTHON ======
// Option A: WebSocket (recommended)
const socket = new WebSocket('ws://localhost:8001');

socket.onmessage = (event) => {
  const data = JSON.parse(event.data);
  drawRobots(data.robots);
  debug.innerHTML = `Robots: ${data.robots.length}`;
};

// Option B: Polling (fallback)
// setInterval(() => {
//   fetch('/robot-data')
//     .then(res => res.json())
//     .then(drawRobots);
// }, 100);

// Initial setup
resizeCanvas();
window.addEventListener('resize', resizeCanvas);
</script>
